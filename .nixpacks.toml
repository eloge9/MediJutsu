# .nixpacks.toml

[phases.setup]
# Packages système nécessaires
packages = [
    "python310",          # Python 3.10
    "curl",
    "wget",
    "unzip",
    "libnss",             # pour Chromium (Playwright)
    "libx11",             # pour Chromium
    "libxcomposite",
    "libxrandr",
    "libxdamage",
    "libxext",
    "libxrender",
    "libatk1.0",
    "libatk-bridge2.0",
    "libgtk-3-0",
    "libpangocairo-1.0-0",
    "libcairo2",
    "libgbm1",
    "fonts-liberation",   # fonts système
    "ttf-ubuntu-font-family",
]

[phases.install]
# Supprime le cache pip pour éviter les conflits
pre = "rm -rf /root/.cache/pip"

[phases.build]
# Crée l'environnement virtuel et installe les dépendances Python
run = '''
python -m venv /opt/venv
. /opt/venv/bin/activate
pip install --upgrade pip
pip install -r requirements.txt
# Installe les navigateurs pour Playwright
playwright install
'''

[phases.start]
# Commande pour lancer ton app Flask
run = '''
. /opt/venv/bin/activate
gunicorn app:app -b 0.0.0.0:8080
'''
