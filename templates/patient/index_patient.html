{% extends "patient/base_patient.html" %}

{% block title %}Tableau de bord - {{ patient.nom_complet }}{% endblock %}

{% block content %}
<div class="app-container">

  <!-- Breadcrumb -->
  <div class="app-hero-header d-flex align-items-center mb-4">
    <ol class="breadcrumb mb-0">
      <li class="breadcrumb-item">
        <i class="ri-home-8-line lh-1 pe-3 me-3 border-end"></i>
        <a href="{{ url_for('index_patient') }}">Accueil</a>
      </li>
      <li class="breadcrumb-item text-primary" aria-current="page">Tableau de bord</li>
    </ol>
  </div>

  <!-- Informations principales du patient -->
  <div class="card mb-3">
    <div class="card-body d-flex align-items-center flex-wrap gap-4">
      <div class="d-flex align-items-center">
        <div class="icon-box lg bg-primary rounded-5 me-2"><i class="ri-account-circle-line fs-3"></i></div>
        <div>
          <h4 class="mb-1">{{ patient.nom_complet }}</h4>
          <p class="m-0">Nom complet</p>
        </div>
      </div>
      <div class="d-flex align-items-center">
        <div class="icon-box lg bg-primary rounded-5 me-2"><i class="ri-women-line fs-3"></i></div>
        <div>
          <h4 class="mb-1">{{ patient.sexe }}</h4>
          <p class="m-0">Sexe</p>
        </div>
      </div>
      <div class="d-flex align-items-center">
        <div class="icon-box lg bg-primary rounded-5 me-2"><i class="ri-arrow-right-up-line fs-3"></i></div>
        <div>
          <h4 class="mb-1">{{ patient.age }}</h4>
          <p class="m-0">Âge</p>
        </div>
      </div>
      <div class="d-flex align-items-center">
        <div class="icon-box lg bg-primary rounded-5 me-2"><i class="ri-contrast-drop-2-line fs-3"></i></div>
        <div>
          <h4 class="mb-1">{{ patient.groupe_sanguin }}</h4>
          <p class="m-0">Groupe sanguin</p>
        </div>
      </div>
      <div class="d-flex align-items-center">
        <div class="icon-box lg bg-secondary rounded-5 me-2"><i class="ri-stethoscope-line fs-3"></i></div>
        <div>
          <h4 class="mb-1">{{ patient.doctor.nom_complet if patient.doctor else 'Non attribué' }}</h4>
          <p class="m-0">Médecin référent</p>
        </div>
      </div>
      <img src="{{ url_for('static', filename='images/patient4.png') }}" class="img-7x rounded-circle ms-auto">
    </div>
  </div>

  <!-- Visites médicales -->
  {% if patient.rendezvous %}
  <div class="card mb-3">
    <div class="card-header">
      <h5>Visites médicales</h5>
    </div>
    <div class="card-body table-responsive">
      <table class="table align-middle m-0">
        <thead>
          <tr>
            <th>Médecin</th>
            <th>Date</th>
            <th>Spécialité</th>
            <th>Observations</th>
          </tr>
        </thead>
        <tbody>
          {% for rdv in patient.rendezvous %}
          <tr>
            <td>{{ rdv.doctor.nom_complet }}</td>
            <td>{{ rdv.date_rdv.strftime('%d/%m/%Y') }}</td>
            <td>{{ rdv.doctor.specialite }}</td>
            <td>{{ rdv.observation or 'Aucune' }}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
  {% endif %}

  <!-- Assurances et dépenses -->
  <div class="row gx-3 mb-4">
    {% if patient.assurances %}
    <div class="col-xl-6 col-sm-12">
      <div class="card mb-3">
        <div class="card-header">
          <h5>Assurances santé</h5>
        </div>
        <div class="card-body">
          <ul class="list-group">
            {% for assurance in patient.assurances %}
            <li class="list-group-item d-flex justify-content-between">
              <span>{{ assurance.nom }}</span>
              <span>{{ assurance.couverture }}%</span>
            </li>
            {% endfor %}
          </ul>
        </div>
      </div>
    </div>
    {% endif %}

    {% if patient.depenses %}
    <div class="col-xl-6 col-sm-12">
      <div class="card mb-3">
        <div class="card-header">
          <h5>Dépenses médicales</h5>
        </div>
        <div class="card-body">
          <ul class="list-group">
            {% for depense in patient.depenses %}
            <li class="list-group-item d-flex justify-content-between">
              <span>{{ depense.description }}</span>
              <span>{{ depense.montant }} {{ depense.devise }}</span>
            </li>
            {% endfor %}
          </ul>
        </div>
      </div>
    </div>
    {% endif %}
  </div>

</div>
{% endblock %}